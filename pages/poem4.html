<!doctype html>
<html>
  <head>
  <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width">
<!--	<script type="text/javascript" src="http://cdn.tonejs.org/latest/Tone.min.js"></script> -->
	<script src="speakClient.js"></script>
	<script src="js/mcluhan.js"></script>
	<script src="js/translator.js"></script>
	<script src="js/lc-playlist.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Anonymous+Pro:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/coding.css">
    <link href="./jcubic/css/jquery.terminal.css" rel="stylesheet"/>
    <script src="./jcubic/js/jquery-1.7.1.min.js"></script>
    <script src="./jcubic/js/jquery.mousewheel-min.js"></script>
    <script src="./jcubic/js/jquery.terminal-min.js"></script>

	<script src="js/jquery-ui.js"></script>
  </head>
  <body>

  	<h1>McLuhan.js: real.time net.art</h1>

  	<div id="main" style="margin:0 auto;width:400px;border:solid 2px #555;padding:5px 0px 0px;position:relative;overflow:hidden">

	  	<canvas id="presence" style="position:absolute;top:0px"></canvas>

		<div id="playlist"></div>

		<div id="terminal" style="z-index:2;text-align:left"></div>

	</div>

	<div id="poemvis"></div>

	<script>

		m.deck(8)

		var current = {
    		wall: "",
    		media: "",
    		type: "",
    		params: ""
    	}

    	var local = {
    		context: "black",
    		walls: [],
    		nextWall: function() {
    			var colori = local.walls.indexOf(local.context)
    			colori++
    			if (colori >= local.walls.length) {
    				colori = 0
    			}
    			return local.walls[colori];
    		}
    	}

		$('#terminal').terminal(function(command) {
           	
           	try {

           		eval( Translate.toCode(command) );
           		var norepeat = command.indexOf("to ")==0 ? true : false;
           		playlist.add(command, local.context, norepeat)
           		return false;

           	} catch(e) {
           		return false;
           	}

           	return false;

           	console.log(command)
           	console.log("doh!")
           	
	    }, {
	        completion: ["add","addsamples","adsr","adsr32","beat","beat32","bounce","bp","chorus","clamp","clshift","delay","destroy","dfb","dlevel","dtime","eval","famt","fenv","ffreq","fres","group","hp","loop","lp","merge","nl","nl32","notch","notes","pan","play","remove","render","render32","reverse","rf","ri","root","sample","saw","select","shift","sine","speed","square","sseq","step","stretch","sync","track","trans","tremolo","tri","type","vol"],
	        greetings: "",
	        prompt: "~ ",
	        keypress: function(e) {
	        	// +
	        	if (e.which==43) {
	        		var nextcolor = rainbow[colorcount.tick()]
	        		//distant.walls[nextcolor] = new wall("line")
	        		distant.createWall(nextcolor);
	        		local.context = nextcolor
	        		local.walls.push(nextcolor)
	        		$("#terminal").terminal().set_command("")
	        		$("#terminal .cmd").css("color", local.context)
	        		return false;
	        	}
	        	// `
	        	if (e.which==96) {
	        		local.context = local.nextWall();
	        		//$("#terminal").terminal().set_command("")
	        		$("#terminal .cmd").css("color", local.context)
	        		return false;
	        	}
	        //  socket.emit('typing',$("#terminal .cmd span")[1].innerHTML)
	        }
	    });

		var rainbow = ["red", "orange", "green", "blue", "purple" ]

		var walls = []


		/* INSTANCES */

		var playlist = new LCPlaylist("playlist", function(data) {
			
			// data.index, data.command, data.event
			
			switch (data.event) {
				case "add":
					poemvis.add(data)
					break;
				case "playback":
					poemvis.highlight(data)
					try {
						eval( Translate.toCode(data.command) )
					} catch(e) {

					}
					break;
			}
			
			

		})

		var poemvis = new PoemVis("poemvis")

		setInterval("playlist.tick()", 1000);







		

	    



	    /* Ben Library */

	    var Counter = function(limit) {
	    	this.max = 0;
	    	this.current = -1;
	    	this.tick = function() {
	    		this.current++;
	    		if (this.current>=this.limit) {
	    			this.current = 0;
	    		}
	    		return this.current;
	    	}
	    	this.downtick = function() {
	    		this.current--;
	    		if (this.current <= this.limit) {
	    			this.current = this.limit-1;
	    		}
	    		return this.current;
	    	}
	    }

	    var colorcount = new Counter(rainbow.length);




	    /* distant */

    	var distant = {
    		walls: {},
    		createWall: function(nextcolor) {
    			window[nextcolor] = new wall("line")
    		}
    	}








	</script>

  </body>
</html>