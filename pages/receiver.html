<!doctype html>
<html>
  <head>
  <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  	<script src="/rhizome/rhizome.js"></script>
	<script src="speakClient.js"></script>
	<script src="js/mcluhan.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style.css">
  </head>
  <body>

  	<h1>McLuhan.js</h1>

	<script>

  var walls = {}
  var receivers = {}
  m.deck(8)

	$(function() {

	  rhizome.start(function(err) {
        // We want to receive all the messages, so we subscribe to '/'
        rhizome.send('/sys/subscribe', ['/'])
      })

      rhizome.on('message', function(address, args) { 
        switch (address) {
          case '/wall':
            if (args[0]=="make") {
              walls[args[1]] = new wall(args[2])
            }
            break;
          case '/media':
            if (args[0]=="make") {
              // ['make',type,wallname,method,params]
              walls[args[2]][args[1]] = walls[args[2]][args[3]](args[4])
            }
            break;
          case '/receiver': 
            console.log("receiver made")
            console.log(args[0])
            console.log(args[1])
            eval("receivers['"+args[0]+"'] = "+args[1])
            var wctx = {
              wall: walls[args[2]],
              media: walls[args[2]][args[3]] ? walls[args[2]][args[3]] : false
            }
            receivers[args[0]] = receivers[args[0]].bind(wctx)
            break;
          case '/control':
            receivers[args[0]](JSON.parse(args[1]))
            console.log(args[1])
            break;
        }
      })

      rhizome.on('connected', function() {
        console.log('connected!')
      })

      rhizome.on('connection lost', function() {
        console.log('connection lost!')
      })

      rhizome.on('queued', function() {
        console.log('queued!')
      })

    })
	</script>

  </body>
</html>